<a id="argocd-deployment" name="argocd-deployment"></a>
## Argo CD Introduction

## Deploy ArgoCD 
Argo CD has already been predeployed for this lab. For contenxt, we do not need to deploy Argo CD on the clusters we want to manage, we could deploy Argo CD to manage a single cluster or multiple clusters. In this lab, for convenience, we are using one of the clusters (`cluster1`) to run the Argo CD components.

A YAML file is provided which deploys the required service accounts, CRDs, roles, role bindings, cluster roles, configmap, secrets, and pods.
If you want to see this file or if you are not running the lab in the Red Hat Tech Exchange the YAML file https://raw.githubusercontent.com/argoproj/argo-cd/v1.1.2/manifests/install.yaml is used to create the resources.

<a id="markdown-exporting-the-web-ui" name="exporting-the-web-ui"></a>
## Export the Web UI
A loadbalancer service must be used to access the web UI for Argo CD. To do this the argocd-server service will be modified.

~~~sh
oc patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}' --context cluster1
~~~

<a id="markdown-login-to-ArgoCD-cli" name="login-to-ArgoCD-cli"></a>
## Login to ArgoCD cli
The first step is to login using the `argocd` binary. We must first get the value of the load balancer created in the previous step.

~~~sh
oc get svc/argocd-server -n argocd --context cluster1
NAME            TYPE           CLUSTER-IP     EXTERNAL-IP                                                               PORT(S)                      AGE
argocd-server   LoadBalancer   172.31.20.40   ae394cb72c45911e9b0aa0edad9ca5b5-1160423475.us-east-1.elb.amazonaws.com   80:31531/TCP,443:30773/TCP   6m3s
~~~

Now use the `argocd` tool to authenticate to the ArgoCD server. We need to use the pod name of the Argo CD server as the password.

~~~sh
LOADBALANCER=$(oc get svc/argocd-server -n argocd -o jsonpath='{ .status.loadBalancer.ingress[0].hostname }')
argocd login $LOADBALANCER --insecure --username admin --password r3dh4t1! 
WARNING: server is not configured with TLS. Proceed (y/n)? y
'admin' logged in successfully
Context '<LOADBALANCER>' updated
~~~

<a id="markdown-adding-clusters" name="adding-clusters"></a>
## Adding Clusters
Using the KUBECONFIG that was generated in the previous lab. We will begin to load the different clusters into Argo CD using the `argocd` binary.

NOTE: Cluster1 will already exist as a defined cluster within Argo CD. It will use the internal kubernetes service address to interact with cluster1.

~~~sh
argocd cluster add cluster2
argocd cluster add cluster3
~~~

Verify the clusters are defined now within Argo CD.

~~~sh
argocd cluster list

SERVER                                 NAME   STATUS      MESSAGE
https://api.east-2.sysdeseng.com:6443  east2  Successful  
https://api.west-2.sysdeseng.com:6443  west2  Successful  
https://kubernetes.default.svc                Successful  
~~~


Next Lab: [Lab 4 - Deploying and Managing a Project with GitOps](./4.md)<br>
Previous Lab: [Lab 2 - Configure OpenShift client context for cluster admin access](./2.md)<br>
[Home](./README.md)
